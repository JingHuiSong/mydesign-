# 本地部署指南

## 📋 前置要求

- Node.js 18.x 或更高版本
- npm、yarn 或 pnpm 包管理器
- OpenRouter API 密钥（用于 AI 图像生成功能）

## 🚀 快速开始

### 1. 安装依赖

项目使用 pnpm，推荐使用相同的包管理器：

```bash
# 如果没有安装 pnpm，先安装
npm install -g pnpm

# 安装项目依赖
pnpm install
```

如果使用其他包管理器：

```bash
# 使用 npm
npm install

# 或使用 yarn
yarn install
```

### 2. 配置环境变量

项目根目录已创建 `.env.local` 文件，请编辑并配置：

```bash
# 必需：OpenRouter API 密钥
OPENROUTER_API_KEY=your_openrouter_api_key_here

# 可选：网站 URL（本地开发时默认为 http://localhost:3000）
NEXT_PUBLIC_SITE_URL=http://localhost:3000
```

#### 获取 OpenRouter API 密钥：

1. 访问 [OpenRouter](https://openrouter.ai/keys)
2. 注册/登录账号
3. 创建新的 API 密钥
4. 复制密钥并替换 `.env.local` 中的 `your_openrouter_api_key_here`

### 3. 启动开发服务器

```bash
pnpm dev
```

或使用其他包管理器：

```bash
npm run dev
# 或
yarn dev
```

### 4. 访问应用

打开浏览器访问：**http://localhost:3000**

## 📦 生产环境构建

### 构建项目

```bash
pnpm build
```

### 启动生产服务器

```bash
pnpm start
```

应用将在 **http://localhost:3000** 运行

## 🔧 功能说明

### 不需要 API 密钥的功能（可离线使用）：
- ✅ 海报编辑器（文本、形状、图片编辑）
- ✅ 图层管理
- ✅ 撤销/重做
- ✅ 对齐工具
- ✅ 本地存储和导出
- ✅ 模板浏览
- ✅ 设计管理

### 需要 API 密钥的功能：
- ⚠️ AI 图像生成（需要 OpenRouter API 密钥）

如果不配置 API 密钥，AI 图像生成功能将不可用，但其他所有编辑功能都能正常使用。

## 🛠️ 常见问题

### 1. 端口被占用

如果 3000 端口被占用，可以指定其他端口：

```bash
# 使用 3001 端口
PORT=3001 pnpm dev
```

### 2. 依赖安装失败

清理缓存并重新安装：

```bash
# pnpm
rm -rf node_modules pnpm-lock.yaml
pnpm install

# npm
rm -rf node_modules package-lock.json
npm install

# yarn
rm -rf node_modules yarn.lock
yarn install
```

### 3. AI 图像生成失败

确保：
- ✅ `.env.local` 中的 `OPENROUTER_API_KEY` 已正确配置
- ✅ API 密钥有效且有余额
- ✅ 网络连接正常
- ✅ 重启开发服务器以加载新的环境变量

### 4. 图片无法显示

项目使用了 Next.js 的图片优化功能，配置为 `unoptimized: true`，应该可以显示所有图片。如果有问题，检查：
- 图片路径是否正确
- public 目录中的图片是否存在

## 📁 项目结构

```
├── app/                    # Next.js App Router 页面
│   ├── page.tsx           # 主页
│   ├── templates/         # 模板库
│   ├── editor/            # 编辑器
│   ├── my-designs/        # 我的设计
│   ├── pricing/           # 价格方案
│   └── api/               # API 路由
│       └── generate-image/# AI 图像生成接口
├── components/            # React 组件
│   ├── poster-editor.tsx  # 编辑器主组件
│   ├── editor-canvas.tsx  # 画布组件
│   ├── editor-toolbar.tsx # 工具栏
│   └── ...
├── lib/                   # 工具函数
│   ├── storage.ts         # 本地存储
│   └── utils.ts           # 工具函数
├── public/                # 静态资源
├── .env.local            # 环境变量（不会提交到 git）
└── .env.example          # 环境变量模板
```

## 🎯 使用技巧

1. **快捷键**：
   - `Ctrl/Cmd + Z` - 撤销
   - `Ctrl/Cmd + Y` 或 `Ctrl/Cmd + Shift + Z` - 重做
   - `Delete` - 删除选中元素

2. **自动保存**：编辑器每 30 秒自动保存

3. **导出格式**：支持导出为 PNG 格式，高清画质

4. **本地存储**：所有设计保存在浏览器 localStorage，清除浏览器数据会丢失

## 📞 技术支持

如有问题，请检查：
1. Node.js 版本是否 >= 18
2. 依赖是否完整安装
3. 环境变量是否正确配置
4. 浏览器控制台是否有错误信息

## 📄 许可证

© 2025 AI海报设计平台. 保留所有权利.

